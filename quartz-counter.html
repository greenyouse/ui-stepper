<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../polymer/polymer.html">

<!--
`quartz-counter`
A basic counter to increment and decrement an integer. It uses a paper-button under the hood
for a ripple animation.

When min and max values are set, the button will disable when it hits those limits.


The following custom properties and mixins are also available for styling:

Custom property | Description | Default
----------------|-------------|----------
--quartz-counter | Mixin applied to the counter | `{}`
--quartz-counter-border | Border style for min and max buttons | `{}`
--quartz-counter-focused-border | Button border style when focused | `{}`
--quartz-counter-outline | Outline style for focused min and max buttons | `--primary-outline`

@demo demo/index.html
-->

<dom-module id="quartz-counter">
  <template>
    <style>
     :host {
       display: block;
       @apply(--quartz-counter);

       --paper-button: {
         border: 2px solid var(--quartz-counter-border);
         border-radius: 25%;
         min-width: 2.5em;
       }

     }

     paper-button:focus {
       outline: var(--quartz-counter-outline, --primary-outline);
       border: var(--quartz-counter-focused-border);
     }

     span {
       margin: 0 1em;
     }
    </style>

    <paper-button id="dec">-</paper-button>
    <span>[[count]]</span>
    <paper-button id="inc">+</paper-button>

  </template>

  <script>
    Polymer({

      is: 'quartz-counter',

      properties: {
        count: {
          type: Number,
          notify: true,
          reflectToAttribute: true,
          value: 0,
          observer: '_setDisabled'
        },

        min: Number,

        max: Number,
      },

      listeners: {
        'inc.tap': '_checkRange',
        'dec.tap': '_checkRange'
      },

      ready: function(){
        // initialize the component's disabled state
        this._setDisabled(this.count, undefined);
      },

      _checkRange: function(e) {
        let id = e.target.id;
        if (id === 'inc') {
          if (this.max === undefined || this.count + 1 <= this.max)
            // block the count change and set inc to disabled
            this.count = this.count + 1;
        } else {
          if (this.min === undefined || this.count - 1 >= this.min)
            // similar but dec is disabled
            this.count = this.count - 1;
        }
      },

      /* Enable or disable buttons based on this.count */
      _setDisabled: function(newVal, oldVal) {
        const min = this.min,
              max = this.max;
        if (newVal === min &&
            (oldVal !== min || oldVal === undefined)) {
          this.$.dec.setAttribute('disabled', true);
        } else if (newVal !== min && oldVal === min) {
          this.$.dec.removeAttribute('disabled');
        }

        if (newVal === max &&
            (oldVal !== max || oldVal === undefined)) {
          this.$.inc.setAttribute('disabled', true);
        } else if (newVal !== max && oldVal === max) {
          this.$.inc.removeAttribute('disabled');
        }
      }

    });
  </script>
</dom-module>
